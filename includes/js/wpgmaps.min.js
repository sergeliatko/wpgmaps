(function(b,a){let mapPlaceholderContainers;let mapLoader=false;let elementWidth=function(c){return c.offsetWidth||c.clientWidth||640};let elementHeight=function(c){return c.offsetHeight||c.clientHeight||480};let isHighDensity=function(){let minResolutionQuery="only screen and (min-resolution: 124dpi), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 48.8dpcm)";let devicePixelRatioQuery="only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 1.3), only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (min-device-pixel-ratio: 1.3)";return((b.devicePixelRatio&&b.devicePixelRatio>1.3)||(b.matchMedia&&(b.matchMedia(minResolutionQuery).matches||b.matchMedia(devicePixelRatioQuery).matches)))};let getScale=function(){return isHighDensity()?"2":"1"};let translateLocation=function(d,c){try{return new c.maps.LatLng(parseFloat(d.latitude),parseFloat(d.longitude))}catch(f){console.log("Error translating location to LatLng: "+f.message+". Using fallback.");return{lt:parseFloat(d.latitude),lg:parseFloat(d.longitude)}}};let getMapHorizontalPadding=function(c){return Math.round(elementWidth(c)*0.05)};let getMapVerticalPadding=function(c){return Math.round(elementHeight(c)*0.05)};let initMapLoader=function(c){if(!mapLoader){let loader=a.createElement("script");loader.type="text/javascript";loader.async=true;loader.src=wpgmaps.loaderUrl;loader.onload=function(){mapLoader=true;b.setTimeout(function(){loadDynamicMap(c)},250)};let location=a.getElementsByTagName("script")[0];location.parentNode.insertBefore(loader,location)}};let loadStaticMap=function(c){let staticMap=c.querySelector(".wpgmap-static");if(null===staticMap){console.log("no static map placeholder found in #"+c.id);return}let width=elementWidth(c);let height=elementHeight(c);let scale=getScale();let url=staticMap.getAttribute("data-url")+"&scale="+scale+"&size="+width.toString()+"x"+height.toString();staticMap.style.backgroundImage="url("+url+")";staticMap.addEventListener("click",function(d){d.preventDefault();loadDynamicMap(this)})};let initStaticMaps=function(){mapPlaceholderContainers=a.querySelectorAll("div.wpgmap");if(mapPlaceholderContainers.length>0){for(let i=0;i<mapPlaceholderContainers.length;i++){let eventName=mapPlaceholderContainers[i].getAttribute("data-event");if(eventName===""||eventName===null){loadStaticMap(mapPlaceholderContainers[i])}else{let mapPlaceholderContainer=mapPlaceholderContainers[i];b.addEventListener(eventName,function(){loadStaticMap(mapPlaceholderContainer)})}}}};let loadDynamicMap=function(c){if(!mapLoader){initMapLoader(c);return}let mapContainer=c.parentNode;let mapKey=mapContainer.getAttribute("data-key");let mapData=wpgmaps.maps[mapKey];let loader=new google.maps.plugins.loader.Loader({apiKey:mapData.key,version:"weekly",id:"wpgmaps-dynamic-maps",libraries:["maps","marker"]});loader.load().then(function(d){let mapElement=a.createElement("div");let infoWindow=new d.maps.InfoWindow();mapElement.id=mapContainer.id+"-dynamic";mapElement.className="wpgmap-dynamic";c.remove();mapContainer.appendChild(mapElement);let map=new d.maps.Map(mapElement,{center:translateLocation(mapData.center,d),mapId:mapElement.id});let bounds=new d.maps.LatLngBounds();mapData.pins.forEach(function(e){let pin=new d.maps.marker.PinElement({scale:1.25});let marker=new d.maps.marker.AdvancedMarkerElement({position:translateLocation(e.marker.location,d),map:map,title:e.marker.title,content:pin.element,gmpClickable:true});bounds.extend(marker.position);marker.addListener("click",function(){infoWindow.close();infoWindow.setContent(e.window);infoWindow.open(marker.map,marker)})});map.fitBounds(bounds,{bottom:getMapVerticalPadding(mapElement),left:getMapHorizontalPadding(mapElement),right:getMapHorizontalPadding(mapElement),top:getMapVerticalPadding(mapElement)});map.setCenter(bounds.getCenter());if(""!==mapData.zoom){let zoomHandler=d.maps.event.addListener(map,"idle",function(){map.setZoom(parseInt(mapData.zoom));d.maps.event.removeListener(zoomHandler)})}})};b.addEventListener("load",initStaticMaps)})(window,document);